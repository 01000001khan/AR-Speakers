<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device=width, initial-scale=1.0">
  <title>Testing Page</title>
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script><!---->
  
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css">
  <link rel="stylesheet" href="universal.css">
</head>
<body>
  <div class="container">
    <form action="https://01000001khan.github.io/AR-Speakers/index.html">
      <input type="submit" value="Home Page" />
    </form>
    
    <form action="https://01000001khan.github.io/AR-Speakers/demo.html">
      <input type="submit" value="Decor Demo Page" />
    </form>

    <model-viewer ar ar-modes="webxr scene-viewer quick-look" camera-controls shadow-intensity="1" shadow-softness="1" enable-pan auto-rotate autoplay ar-placement="wall" environment-image="neutral" src="assets/models/decor/decorC1.glb" ios-src="assets/models/decor/decorC1.usdz">
      <input type="range" min="0" max="0.99" step="0.01" value="0.5" oninput="animationUpdate(this)">
    </model-viewer>

    <model-viewer ar ar-modes="webxr scene-viewer quick-look" camera-controls shadow-intensity="1" shadow-softness="1" enable-pan autoplay ar-placement="wall" environment-image="neutral" src="assets/models/decor/decorC1 b.glb" id="walldemo">
      <input type="range" min="0" max="0.99" step="0.01" value="0.5" oninput="animationUpdate(this)">
    </model-viewer>

    <model-viewer ar ar-modes="webxr scene-viewer quick-look" camera-controls shadow-intensity="1" shadow-softness="1" enable-pan autoplay ar-placement="wall" environment-image="neutral" src="assets/models/general/renderingtest.glb">
      <input type="range" min="0" max="0.99" step="0.01" value="0.5" oninput="animationUpdate(this)">
    </model-viewer>

    <model-viewer ar ar-modes="webxr scene-viewer quick-look" camera-controls shadow-intensity="1" shadow-softness="1" enable-pan auto-rotate environment-image="neutral" src="assets/models/general/martinLoganESLtest.glb">
    </model-viewer>

    <model-viewer ar ar-modes="webxr scene-viewer quick-look" camera-controls shadow-intensity="1" shadow-softness="1" enable-pan auto-rotate environment-image="assets/textures/leadenhall.hdr" src="assets/models/general/wall small.glb">
    </model-viewer>
    
    <model-viewer ar ar-modes="webxr scene-viewer quick-look" camera-controls shadow-intensity="1" shadow-softness="1" enable-pan auto-rotate environment-image="assets/textures/leadenhall.hdr" src="assets/models/general/wall.glb">
    </model-viewer>
    
    <model-viewer ar ar-modes="webxr scene-viewer quick-look" camera-controls shadow-intensity="1" shadow-softness="1" enable-pan auto-rotate environment-image="neutral" src="assets/models/general/car.glb">
    </model-viewer>
    
    <model-viewer ar ar-modes="webxr scene-viewer quick-look" camera-controls shadow-intensity="1" shadow-softness="1" enable-pan auto-rotate environment-image="neutral" src="assets/models/general/eliteE3.glb">
    </model-viewer>
    
    <select class="controls" ,="" id="color-controls">
      <option value="assets/textures/persona/ariaBlueMetallic.jpg">                           Aria Blue Metallic      </option>
      <option value="assets/textures/persona/harmonyWhiteGloss.jpg">                          Harmony White Gloss    </option>
      <option value="assets/textures/persona/sonicSilverMetallic.jpg" selected="selected">    Sonic Silver Metallic   </option>
      <option value="assets/textures/persona/saffronYellowMetallic.jpg">                      Saffron Yellow Metallic </option>
      <option value="assets/textures/persona/candyAppleRedMetallic.jpg">                      Candy Apple Red Metallic </option>
      <option value="assets/textures/persona/amethystGloss.jpg">                              Amethyst Gloss          </option>
      <option value="assets/textures/walnut.jpg">                                             Non-Existent Testing Material</option>
    </select>
      
    <P>Regular Version</P>
    <model-viewer id="speaker" ar ar-modes="webxr scene-viewer quick-look" camera-controls shadow-intensity="1" shadow-softness="1" enable-pan auto-rotate src="assets/models/persona/personaSub.glb">
    </model-viewer>
  
    <P>Sparkly</P>
    <model-viewer id="speaker" ar ar-modes="webxr scene-viewer quick-look" camera-controls shadow-intensity="1" shadow-softness="1" enable-pan auto-rotate src="assets/models/persona/personaSubSparkle.glb">
    </model-viewer>
  
    <model-viewer ar ar-modes="webxr scene-viewer quick-look" camera-controls shadow-intensity="1" shadow-softness="1" enable-pan auto-rotate src="https://modelviewer.dev/shared-assets/models/glTF-Sample-Models/2.0/DamagedHelmet/glTF/DamagedHelmet.gltf" environment-image="https://modelviewer.dev/shared-assets/environments/spruit_sunrise_1k_HDR.hdr">
    </model-viewer>

    <model-viewer ar ar-modes="webxr scene-viewer quick-look" camera-controls shadow-intensity="1" shadow-softness="1" enable-pan auto-rotate src="https://modelviewer.dev/shared-assets/models/Astronaut.glb" environment-image="https://modelviewer.dev/shared-assets/environments/spruit_sunrise_1k_HDR.hdr">
    </model-viewer>

    <model-viewer ar ar-modes="webxr scene-viewer quick-look" camera-controls shadow-intensity="1" shadow-softness="1" enable-pan auto-rotate src="https://modelviewer.dev/shared-assets/models/glTF-Sample-Models/2.0/ToyCar/glTF-Binary/ToyCar.glb" environment-image="https://modelviewer.dev/shared-assets/environments/spruit_sunrise_1k_HDR.hdr">
    </model-viewer>
  
    <model-viewer ar ar-modes="webxr scene-viewer quick-look" camera-controls shadow-intensity="1" shadow-softness="1" enable-pan auto-rotate src="assets/models/general/AlphaBlendModeTest.glb" environment-image="https://modelviewer.dev/shared-assets/environments/spruit_sunrise_1k_HDR.hdr">
    </model-viewer>
  
    <model-viewer ar ar-modes="webxr scene-viewer quick-look" camera-controls shadow-intensity="1" shadow-softness="1" enable-pan auto-rotate environment-image="neutral" src="assets/models/general/tv.glb">
    </model-viewer>
  
    <p>Persona Finishes Testing</p>
    
    <model-viewer ar ar-modes="webxr scene-viewer quick-look" camera-controls shadow-intensity="1" shadow-softness="1" enable-pan auto-rotate environment-image="neutral" src="assets/models/persona/personaFinishSpheresMatrix.glb">
    </model-viewer>  
  
    <model-viewer ar ar-modes="webxr scene-viewer quick-look" camera-controls shadow-intensity="1" shadow-softness="1" enable-pan auto-rotate environment-image="neutral" src="assets/models/persona/personaFinishSpheres.glb">
    </model-viewer>
  
    <model-viewer ar ar-modes="webxr scene-viewer quick-look" camera-controls shadow-intensity="1" shadow-softness="1" enable-pan auto-rotate environment-image="neutral" src="assets/models/persona/personaFinishExperiment.glb">
    </model-viewer>
  
    <model-viewer ar ar-modes="webxr scene-viewer quick-look" camera-controls shadow-intensity="1" shadow-softness="1" enable-pan auto-rotate environment-image="neutral" src="assets/models/general/eslGrilleMesh.glb">
    </model-viewer>
    
    <model-viewer ar ar-modes="webxr scene-viewer quick-look" camera-controls shadow-intensity="1" shadow-softness="1" enable-pan auto-rotate environment-image="neutral" src="assets/models/general/defiancexr13.glb" onload="hide();">
      <p>Defiance XR13</p>
    </model-viewer>

  </div>

  <script>
  const speakers = document.querySelectorAll("#speaker");
  const speaker = document.querySelector("#speaker");      
  const colorSelector = document.querySelector('#color-controls');    

  speaker.addEventListener("load", () => {

    const createAndApplyTexture = async (channel, event) => {
      const texture = await speaker.createTexture(colorSelector.value);
      
      speakers.forEach(function(speaker){
        const material = speaker.model.materials[0];
        material.pbrMetallicRoughness[channel].setTexture(texture);
        
        
        material.pbrMetallicRoughness.setRoughnessFactor(0.0);
        material.pbrMetallicRoughness.setMetallicFactor(0.0);
      });
    }

      
    document.querySelector('#color-controls').addEventListener('input', (event) => {
      createAndApplyTexture('baseColorTexture', event);
    });

    speakers.forEach(function(speaker){
      speaker.addEventListener('load', (event) => {
        createAndApplyTexture('baseColorTexture', event);
      });
    });

    
  });


  function animationUpdate(elem){
      elem.parentElement.pause();
      elem.parentElement.currentTime = elem.value;

      setTimeout(() => {
        elem.parentElement.pause();
      },2500);
  }

  const wall = document.querySelector("#walldemo");
  wall.onload = () => {
    screenTexture(wall, 1)
  }

  function screenTexture(elem, i){
    mat = elem.model.materials[7]["emissiveTexture"];
    video = elem.createVideoTexture("./assets/textures/particles.mp4");
    
    
    setTimeout(() => {
      console.log("Screen attempt:",i)
      if (document.readyState === "complete"){ 
        mat.setTexture(video);
        elem.pause();
      }else{
        screenTexture(elem, i++);
      }
    }, 500);
  }  
  </script>
  
</body>
</html>
