<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device=width, initial-scale=1.0">
  <title>Testing Page</title>
  <script type="module" src="https://unpkg.com/@google/model-viewer/dist/model-viewer.min.js"></script>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@1/css/pico.min.css">
  <link rel="stylesheet" href="universal.css">
</head>

<body>
  
  <div class="container">
    <h1 style="text-align: center;">Decor C1 Demo Page</h1>
  </div><br>

  <div id="stuff"></div>
  <script type="module" src="demo.js"></script>

  <div class="container">
    <model-viewer ar ar-modes="webxr scene-viewer quick-look" camera-controls shadow-intensity="1" shadow-softness="1"
      enable-pan autoplay ar-placement="wall" environment-image="neutral" src="assets/models/decor/decorC1 b.glb" id="walldemo">
      <input type="range" min="0" max="0.99" step="0.01" value="0.5" oninput="animationUpdate(this)" id="slider">
    </model-viewer>
  </div>


  <script>
    function animationUpdate(elem) {
      elem.parentElement.pause();
      elem.parentElement.currentTime = elem.value;

      setTimeout(() => {
        elem.parentElement.pause();
      }, 2500);
    }

    document.querySelectorAll('model-viewer').forEach((e)=>{
        e.onload = ()=>{
          animationUpdate(e.firstChild);
        };
    });

    const wall = document.querySelector("#walldemo");
    wall.onload = () => {
      screenTexture(wall, 1)
    }

    function screenTexture(elem, i) {
      mat = elem.model.getMaterialByName('Ecran')["emissiveTexture"];
      video = elem.createVideoTexture("./assets/textures/particles.mp4");


      setTimeout(() => {
        console.log("Screen attempt:", i)
        if (document.readyState === "complete") {
          mat.setTexture(video);
          elem.pause();
        } else {
          screenTexture(elem, i++);
        }
      }, 500);
    }  
  </script>

</body>
</html>